{% extends "base.html" %}

{% block title %}ğŸ“¡ IoT Vehicle Nodes{% endblock %}

{% block styles %}
<style>
    .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    .vehicle-card {
        border: 1px solid #0f0;
        background: #050505;
        padding: 15px;
        border-radius: 5px;
    }
    .vehicle-header {
        display: flex;
        justify-content: space-between;
        border-bottom: 1px dashed #0f0;
        padding-bottom: 10px;
        margin-bottom: 10px;
    }
    .vehicle-id {
        font-weight: bold;
        color: #0f0;
    }
    .vehicle-status {
        color: #0f0;
        font-size: 0.9em;
    }
    .telemetry-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        font-size: 0.9em;
    }
    .stego-preview {
        margin-top: 15px;
        border: 1px solid #333;
        width: 100%;
        height: 150px;
        background: #111;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #666;
        font-size: 0.8em;
    }
</style>
{% endblock %}

{% block content %}
    <h1>ğŸ“¡ <span class="lang-el">ÎšÏŒÎ¼Î²Î¿Î¹ ÎŸÏ‡Î·Î¼Î¬Ï„Ï‰Î½ IoT</span><span class="lang-en">IoT Vehicle Nodes</span></h1>
    <p>
        <span class="lang-el">Î–Ï‰Î½Ï„Î±Î½Î® Ï€Î±ÏÎ±ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎ· ÎºÎ¹Î½Î¿ÏÎ¼ÎµÎ½Ï‰Î½ ÎºÏŒÎ¼Î²Ï‰Î½ Ï€Î¿Ï… Î¼ÎµÏ„Î±Î´Î¯Î´Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î¼Î­ÏƒÏ‰ PhantomFace Steganography.</span>
        <span class="lang-en">Live monitoring of mobile nodes transmitting data via PhantomFace Steganography.</span>
    </p>

    <div id="dashboard" class="dashboard-grid">
        <!-- Cards will be injected here -->
        <div style="grid-column: 1/-1; text-align: center;">Loading IoT Nodes...</div>
    </div>
{% endblock %}

{% block scripts %}
<script>
    async function loadIoTData() {
        try {
            const response = await fetch('/api/iot/data');
            const data = await response.json();
            const container = document.getElementById('dashboard');
            container.innerHTML = '';

            if (data.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center;">No active vehicle nodes found.</div>';
                return;
            }

            data.forEach(vehicle => {
                const card = document.createElement('div');
                card.className = 'vehicle-card';
                card.innerHTML = `
                    <div class="vehicle-header">
                        <span class="vehicle-id">ğŸš— ${vehicle.vehicle_id}</span>
                        <span class="vehicle-status">â— ONLINE</span>
                    </div>
                    <div class="telemetry-row">
                        <span>Speed:</span>
                        <span>${vehicle.speed} km/h</span>
                    </div>
                    <div class="telemetry-row">
                        <span>GPS:</span>
                        <span>${vehicle.gps}</span>
                    </div>
                    <div class="telemetry-row">
                        <span>Fuel:</span>
                        <span>${vehicle.fuel}%</span>
                    </div>
                    <div class="telemetry-row">
                        <span>Last Update:</span>
                        <span>${vehicle.timestamp}</span>
                    </div>
                    <div class="stego-preview">
                        [Stego-Image Preview]<br>
                        ${vehicle.last_image_hash ? vehicle.last_image_hash.substring(0, 16) + '...' : 'No Image'}
                    </div>
                `;
                container.appendChild(card);
            });
        } catch (error) {
            console.error('Error fetching IoT data:', error);
            document.getElementById('dashboard').innerHTML = 
                '<div style="grid-column: 1/-1; text-align: center; color: red;">Error loading dashboard.</div>';
        }
    }

    // Refresh every 5 seconds
    loadIoTData();
    setInterval(loadIoTData, 5000);
</script>
{% endblock %}